<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>Alarmmonitor WLAN-Konfiguration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        background: #0b1d2a;
        color: #f2f7ff;
      }
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
      }
      main {
        max-width: 720px;
        width: 100%;
        padding: 2rem 1.5rem 3rem;
        background: rgba(13, 31, 44, 0.9);
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.25);
        border-radius: 18px;
        margin: 1.5rem;
      }
      h1, h2 {
        font-weight: 600;
        margin-bottom: 1rem;
      }
      .networks, .configured {
        margin-bottom: 2rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
      }
      th, td {
        padding: 0.75rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      th {
        text-align: left;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.08em;
        opacity: 0.7;
      }
      tr:hover td {
        background: rgba(255, 255, 255, 0.05);
      }
      .quality {
        font-variant-numeric: tabular-nums;
      }
      form {
        margin: 0;
      }
      .form-grid {
        display: grid;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      label {
        display: flex;
        flex-direction: column;
        font-size: 0.95rem;
        gap: 0.25rem;
      }
      input[type="text"],
      input[type="password"],
      select {
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(11, 29, 42, 0.8);
        color: inherit;
      }
      input[type="checkbox"] {
        accent-color: #ffb100;
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        justify-content: flex-end;
      }
      button {
        padding: 0.75rem 1.5rem;
        border-radius: 999px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(120deg, #ff8200, #ffb100);
        color: #0b1d2a;
        box-shadow: 0 8px 20px rgba(255, 128, 0, 0.35);
      }
      button.secondary {
        background: rgba(255, 255, 255, 0.12);
        color: inherit;
        box-shadow: none;
      }
      .flash {
        padding: 0.85rem 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        background: rgba(57, 181, 74, 0.15);
        border: 1px solid rgba(57, 181, 74, 0.35);
      }
      .flash.error {
        background: rgba(214, 69, 65, 0.18);
        border-color: rgba(214, 69, 65, 0.4);
      }
      .footnote {
        font-size: 0.85rem;
        opacity: 0.7;
        line-height: 1.5;
      }
      @media (max-width: 480px) {
        main {
          padding: 1.5rem;
          margin: 1rem;
        }
        th, td {
          padding: 0.6rem;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>WLAN-Verbindung einrichten</h1>
      {% for category, message in get_flashed_messages(with_categories=true) %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}

      <section class="networks">
        <h2>Gefundene Netzwerke</h2>
        <p class="footnote">Aktive Hotspot-Clients erhalten die Adresse <code>{{ hotspot_subnet }}</code>. Wählen Sie die gewünschte SSID und geben Sie das Passwort ein.</p>
        {% if networks %}
          <table>
            <thead>
              <tr>
                <th>SSID</th>
                <th>Signal</th>
                <th>Sicherheit</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for network in networks %}
                <tr>
                  <td>{{ network.ssid or 'Unbenannt' }}</td>
                  <td class="quality">{{ network.quality or '–' }}{% if network.quality %} %{% endif %}</td>
                  <td>{{ 'Verschlüsselt' if network.secure else 'Offen' }}</td>
                  <td>
                    <form method="post" action="{{ url_for('connect') }}">
                      <input type="hidden" name="ssid" value="{{ network.ssid }}">
                      <div class="form-grid">
                        {% if network.secure %}
                          <label>
                            Passwort
                            <input type="password" name="password" placeholder="WLAN-Passwort" required>
                          </label>
                        {% else %}
                          <label>
                            Passwort (optional)
                            <input type="text" name="password" placeholder="Für offene Netzwerke leer lassen">
                          </label>
                        {% endif %}
                        <label>
                          <span>
                            <input type="checkbox" name="hidden"> Versteckte SSID
                          </span>
                        </label>
                      </div>
                      <div class="actions">
                        <button type="submit">Verbinden</button>
                      </div>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>Es wurden keine Netzwerke gefunden. Bitte versuchen Sie es erneut oder positionieren Sie den Pi näher an Ihrem Router.</p>
        {% endif %}
      </section>

      <section class="configured">
        <h2>Gespeicherte Netzwerke</h2>
        {% if configured_networks %}
          <table>
            <thead>
              <tr>
                <th>SSID</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for network in configured_networks %}
                <tr>
                  <td>{{ network.ssid }}</td>
                  <td>{% if active_ssid == network.ssid %}Verbunden{% else %}Gespeichert{% endif %}</td>
                  <td>
                    <form method="post" action="{{ url_for('forget', network_id=network.id) }}">
                      <div class="actions">
                        <button class="secondary" type="submit">Entfernen</button>
                      </div>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>Es sind noch keine WLANs gespeichert.</p>
        {% endif %}
      </section>

      <section>
        <h2>Manuelle Eingabe</h2>
        <form method="post" action="{{ url_for('connect') }}">
          <div class="form-grid">
            <label>
              SSID
              <input type="text" name="ssid" placeholder="Name des WLANs" required>
            </label>
            <label>
              Passwort
              <input type="password" name="password" placeholder="WLAN-Passwort (min. 8 Zeichen)">
            </label>
            <label>
              <span>
                <input type="checkbox" name="hidden"> Versteckte SSID
              </span>
            </label>
          </div>
          <div class="actions">
            <button type="submit">Speichern &amp; Verbinden</button>
          </div>
        </form>
      </section>
    </main>
  </body>
</html>
